# State Evidence Map (Facts Only)

This evidence map lists claims with direct file-based evidence.
No inference or planning is included.

---

## A) What is working (as-built)

- Claim: Runner V2 can create run bundles under `runtime/runs/`.
  - Evidence: `runtime/runs/sayur_052_066/RUN_sayur_052_066_20260109T202745/`
  - Confidence: high

- Claim: Run bundles include standard files (manifest, logs, outputs, eval).
  - Evidence: `runtime/runs/sayur_052_066/RUN_sayur_052_066_20260109T202745/manifest.json`, `logs/run.log`, `outputs/*.json`, `eval/output_contract_checks.txt`
  - Confidence: high

- Claim: Indexer-generated indices exist for runs, proposals, closures, and inbox.
  - Evidence: `runtime/indices/run_index.json`, `runtime/indices/proposal_index.json`, `runtime/indices/closure_index.json`, `runtime/indices/inbox_index.json`
  - Confidence: high

- Claim: Review queue index is generated by the indexer.
  - Evidence: `runtime/indexer.py` lines 544–547 (writes `review_queue_index.json`), `runtime/indices/review_queue_index.json`
  - Confidence: high

- Claim: Page sources ingest exists with provenance.
  - Evidence: `runtime/data/ingest/page_sources/png/`, `runtime/data/ingest/page_sources/ocr_txt/`, `runtime/data/ingest/page_sources/ocr_tsv/`, `runtime/data/ingest/page_sources/PROVENANCE.json`
  - Confidence: high

- Claim: Page sources coverage index is generated.
  - Evidence: `runtime/indices/page_sources_coverage_index.json`
  - Confidence: high

- Claim: Page-based ingest contracts exist for agent usage, validation, OCR correction, and definitive source builds.
  - Evidence: `documentation/operator/AGENT_USAGE_CONTRACT_PAGE_SOURCES.md`, `documentation/operator/VALIDATOR_CONTRACT_PAGE_BASED_OUTPUTS.md`, `documentation/operator/OCR_CORRECTION_CONTRACT.md`, `documentation/operator/DEFINITIVE_SOURCE_BUILD_CONTRACT.md`
  - Confidence: high

- Claim: Excerpt metadata is recorded in run manifests and run index.
  - Evidence: `runtime/runs/*/manifest.json` (excerpt_id/source/version), `runtime/indices/run_index.json`
  - Confidence: high

- Claim: M2 core evidence (excerpt-level run orchestration) is sufficient.
  - Evidence: `runtime/runs/*/`, `runtime/indices/run_index.json`
  - Confidence: high

- Claim: Runner entrypoint is present and requires excerpt metadata.
  - Evidence: `runtime/scripts/mustika_run_excerpt.py` (required args)
  - Confidence: high

- Claim: Review packs exist as filesystem artefacts under proposals.
  - Evidence: `runtime/proposals/P-001/review_pack/summary.md`, `runs.json`, `checks.md`
  - Confidence: high
  - Note: M3 sufficient evidence (review packs + proposals/closures).

- Claim: Excerpt coverage validation script is runnable and produces a coverage report artifact.
  - Evidence: `runtime/scripts/validate_excerpt_coverage.py`, `runtime/audit/coverage_report_latest.md`
  - Confidence: high

- Claim: Reindex wrapper script targets runtime base path.
  - Evidence: `runtime/scripts/reindex_runtime.sh`
  - Confidence: high

- Claim: API exposes review_pack_files from proposal review_pack directory.
  - Evidence: `runtime/api_server.py` (review_pack_path, review_pack_files in response)
  - Confidence: high
  - Note: M3 sufficient evidence (proposal review_pack exposure).

- Claim: UI exposes run comparison view via a route and component, backed by run-regression API endpoints.
  - Evidence: `runtime/ui/src/App.tsx`, `runtime/ui/src/components/RunComparisonView.tsx`, `runtime/api_server.py`, `runtime/ui/src/api.ts`
  - Confidence: high
 
- Claim: Coverage dashboard reads page_sources coverage via read-only API and renders aggregate counts/gaps.
  - Evidence: `runtime/ui/src/components/CoverageDashboard.tsx` (api.getPageSourcesCoverage; counts/gaps), `runtime/api_server.py` (`/page-sources-coverage`)
  - Confidence: high

- Claim: Coverage dashboard explicitly labels chapter coverage as unavailable and excerpt-level breakdown as unavailable.
  - Evidence: `runtime/ui/src/components/CoverageDashboard.tsx` (labels)
  - Confidence: high

- Claim: Review Queue UI route exists with inbox-based filters and Next/Prev navigation.
  - Evidence: `runtime/ui/src/App.tsx` (`/review-queue`), `runtime/ui/src/components/Inbox.tsx` (filters + label), `runtime/ui/src/components/ReviewPackViewer.tsx` + `runtime/ui/src/components/RunDetail.tsx` (Prev/Next links)
  - Confidence: high

---

## B) What exists but is incomplete
Note: M1 is DONE; items below are labeled per M1 scope.

- Claim: Chapter registry exists and contains entries. [Resolved for M1 (administrative)]
  - Evidence: `runtime/data/origineel/hoofdstuk1.txt`, `runtime/data/source_imports/legacy_agentic_inputs/workspace/00_input/hoofdstuk_*.txt`, `documentation/system_overview/CHAPTER_REGISTRY.md`
  - Confidence: medium

- Claim: Segment ledgers exist (RB/BLK) but are not linked to chapters or excerpts. [Out of scope for M1 (M2+)]
  - Evidence: `runtime/data/source_imports/legacy_mr2026_alignment_spine/DERIVED/step4_structure/ledgers/recipe_block_manifest.tsv`
  - Confidence: high

- Claim: Excerpt registry is populated with at least two entries. [Resolved for M1 (administrative)]
  - Evidence: `documentation/system_overview/EXCERPT_REGISTRY.md` (hoofdstuk_01_001, hoofdstuk_02_001)
  - Confidence: high

- Claim: Chapter → excerpt alignment artifact exists and covers all listed chapters. [Resolved for M1 (administrative)]
  - Evidence: `documentation/system_overview/EXCERPT_ALIGNMENT_INDEX.md`, `documentation/system_overview/CHAPTER_REGISTRY.md`
  - Confidence: high

- Claim: Ingest artifacts with provenance exist for hoofdstuk_01 and hoofdstuk_02. [Resolved for M1 (administrative)]
  - Evidence: `runtime/data/ingest/chapters/hoofdstuk_01/provenance.json`, `runtime/data/ingest/chapters/hoofdstuk_02/provenance.json`, `runtime/data/ingest/chapters/README.md`
  - Confidence: high

- Claim: Page OCR correction layer exists (prepared, not populated). [Out of scope for M1 (M2+)]
  - Evidence: `runtime/data/ingest/page_ocr_corrected/pages/`, `runtime/data/ingest/page_ocr_corrected/manifests/`
  - Confidence: high

- Claim: Definitive source build layer exists (prepared, not populated). [Out of scope for M1 (M2+)]
  - Evidence: `runtime/data/ingest/definitive_source/builds/`, `runtime/data/ingest/definitive_source/manifests/`
  - Confidence: high

- Claim: OCR and physical sources are staged but not linked to run metadata. [Out of scope for M1 (M2+)]
  - Evidence: `runtime/data/source_imports/legacy_mr2026_alignment_spine/ocr_txt/`, `ocr_tsv/`, `images/`, `pdf/`
  - Confidence: high

---

## C) Hard invariants (must not break)

- Claim: Filesystem-first and derived indices are required.
  - Evidence: `documentation/system_overview/PROJECT_STATE_PACK.md`
  - Confidence: high

- Claim: No auto-promotion and canonical read-only.
  - Evidence: `documentation/system_overview/PROJECT_STATE_PACK.md`
  - Confidence: high

- Claim: Closures are immutable.
  - Evidence: `documentation/system_overview/PROJECT_STATE_PACK.md`
  - Confidence: high

---

## D) Known gaps (blocking full-system goal)
Note: M1 is DONE; items below are labeled per M1 scope.

- Claim: Chapter → excerpt alignment exists as documentation only; no runtime index exposes chapter/excerpt mapping. [Out of scope for M1 (M2+)]
  - Evidence: `documentation/system_overview/EXCERPT_ALIGNMENT_INDEX.md`, `documentation/system_overview/BOOK_STRUCTURE_FACTS.md` (indices expose runs by excerpt_id only)
  - Confidence: medium

- Claim: Excerpt registry is only partially populated; mapping artifacts are still missing. [Historical/legacy phrasing (updated)]
  - Evidence: `documentation/system_overview/EXCERPT_REGISTRY.md` (Notes: “Population requires explicit mapping artifacts not currently present.”)
  - Confidence: high

- Claim: Chapter-level english and rough_nl inputs are missing for ingest. [Out of scope for M1 (M2+)]
  - Evidence: `runtime/data/ingest/chapters/hoofdstuk_01/provenance.json`, `runtime/data/ingest/chapters/hoofdstuk_02/provenance.json` (notes)
  - Confidence: high

- Claim: Batch run orchestration per chapter exists as a script; input requirement is conceptually mismatched (afgeleid ≠ bron). [Out of scope for M2]
  - Evidence: `runtime/scripts/batch_run_chapter.py`, `runtime/data/ingest/chapters/hoofdstuk_01/provenance.json`
  - Confidence: medium

---

## E) Missing or stale documents (expected paths)

- Claim: ADRs referenced in planning are not present.
  - Evidence: `docs/adrs/` directory not found in repo
  - Confidence: high

- Claim: ARCH_ALIGNMENT_REPORT.md is not present in clean repo.
  - Evidence: no `documentation/reports/ARCH_ALIGNMENT_REPORT.md` found
  - Confidence: high

## Milestone 5 — Operational Reliability + Regression Checks

- Index regression audit artefact definition (expected path):
  - runtime/audit/index_regression_report_latest.md
  - Scope: semantic diff of runtime/indices/ vs runtime/audit/index_snapshot_pre/, ignoring generated_at.
- Run output regression audit artefact definition (expected path):
  - runtime/audit/run_regression_sayur_052_066_RUN_sayur_052_066_20260109T172343_vs_RUN_sayur_052_066_20260109T173327.md
  - Scope: compare outputs/ and eval/ between two runs; record if empty (informational).
- Pre-regression snapshot staging directory (observed on disk):
  - runtime/audit/index_snapshot_pre/
- Copy-only backup and restore workflow documented:
  - documentation/operator/BACKUP_AND_RESTORE_RUNTIME.md
  - documentation/operator/RUNBOOK.md (reindex section)
- Verification evidence:
  - runtime/audit/index_regression_report_latest.md
  - runtime/audit/index_snapshot_pre/
  - runtime/audit/api_actions.log
ADDED: This evidence chain maps to the editorial Input → Proposal → Decision phases (source-bound indices, proposal/review runs, and closure-facing regressions) and confirms regression/reindex checks link those phases with consistent snapshots.
ADDED: The DoD for run logging & reproducibility (see `documentation/system_overview/PROJECT_STATE_PACK.md`) reuses these audit/regression artefacts to define audit-/comparison-ready “reproducibility” without implying deterministic reruns.

As-built (2026-01-14):
- Scripts present: runtime/scripts/regression_check_run_outputs.py; runtime/scripts/regression_check_indices.py. (path: runtime/scripts/regression_check_run_outputs.py, lines: 1-5; path: runtime/scripts/regression_check_indices.py, lines: 1-9)
- Run output report present: runtime/audit/run_regression_does_not_exist_a_vs_does_not_exist_b.md. (path: runtime/audit/run_regression_does_not_exist_a_vs_does_not_exist_b.md, lines: 1-6)
- Index report present: runtime/audit/index_regression_report_latest.md. (path: runtime/audit/index_regression_report_latest.md, lines: 1-6)
- Run output scope observed: outputs/ and eval/. (path: runtime/audit/run_regression_does_not_exist_a_vs_does_not_exist_b.md, lines: 18-20)
- Index scope observed: runtime/indices vs runtime/audit/index_snapshot_pre; generated_at ignored. (path: runtime/audit/index_regression_report_latest.md, lines: 5-14)
- Output-dir guard message: "ERROR: output-dir must be under" (path: runtime/scripts/regression_check_run_outputs.py, lines: 163-172)
- Writes constrained to runtime/audit; canonical remains read-only. (path: runtime/scripts/regression_check_run_outputs.py, lines: 163-178; path: documentation/system_overview/GOVERNANCE.md, lines: 10-13, 44-46)
- Run comparison view route + component, plus run-regression API endpoints and UI client functions. (path: runtime/ui/src/App.tsx, lines: 30-37; path: runtime/ui/src/components/RunComparisonView.tsx, lines: 1-90; path: runtime/api_server.py, lines: 278-340; path: runtime/ui/src/api.ts, lines: 82-105)
